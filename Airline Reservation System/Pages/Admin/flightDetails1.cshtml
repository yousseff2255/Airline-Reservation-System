@page
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@model Airline_Reservation_System.Pages.Admin.FlightDetails1Model
@{
    ViewData["name"] = "sidebar";
}

<script>
    const getcrew = @Html.Raw(Json.Serialize(Model.getc));
    
</script>

<form method="post">
    @Html.AntiForgeryToken()  <!-- This generates the CSRF token -->
    <!-- Your form fields go here -->
</form>




<div class="container-sm">
    <div class="content ">

    <div class="mb-4">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="#">
                        <i class="bi bi-globe2 small me-2"></i> Dashboard
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Order Detail</li>
            </ol>
        </nav>
    </div>

    <div class="row">
        <div class="col-lg-8 col-md-12">
            <div class="card mb-4">
                <div class="card-body">
                    <div class="mb-5 d-flex align-items-center justify-content-between">
                        <span>Flight No : <a href="#">#5355619</a></span>
                        <span class="badge bg-success">Completed</span>
                    </div>
                    <div class="row mb-5 g-4">
                        <div class="col-md-3 col-sm-6">
                            <p class="fw-bold">Depature Date</p>
                            16/06/2021 at 04:23 PM
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <p class="fw-bold">Aircraft</p>
                            Airbus
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <p class="fw-bold">From</p>
                            cairo
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <p class="fw-bold">To</p>
                            Paris
                        </div>
                    </div>
                    <div class="row g-4">
                        <div class="col-md-6 col-sm-12">
                            <div class="card">
                                <div class="card-body d-flex flex-column gap-3">
                                    <div class="d-flex justify-content-between">
                                        <h5 class="mb-0">Flight Crew</h5>
                                           
                                        @* <a href="#" id="">Edit</a>
                                            <a href="#" id="" style="display:none">save</a> *@
                                            
                                    </div>
                                        @{
                                            for (int i = 0; i < Model.crew.Rows.Count; i++)
                                            {
                                                    <div class="editable">
                                                        Name: @Model.crew.Rows[i][0] @Model.crew.Rows[i][1]
                                                    </div>
                                                    <div>
                                                        Role: @Model.crew.Rows[i][2]
                                                    </div>
                                            }
                                        }
                                        @* <div class="editable">Name: John Smith</div> *@
                                    @* <div>Role: Pilot</div>
                                    <div>Name: Jane Doe</div>
                                    <div>
                                        Role: Co-Pilot
                                    </div> *@
                                </div>
                            </div>
                        </div>
                            


                        <div class="col-md-6 col-sm-12">
                            <div class="card">
                                <div class="card-body d-flex flex-column gap-3">
                                    <div class="d-flex justify-content-between">
                                        <h5 class="mb-0">Cabin Crew</h5>
                                        <a href="#">Edit</a>
                                    </div>
                                    <div>Name: Sarah Brown</div>
                                    <div>Role: Flight Attendant</div>
                                    <div>Name: Michael Lee</div>
                                    <div>
                                        Role: Flight Attendant
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card widget">
                <h5 class="card-header">Passanger</h5>
                <div class="card-body">
                    <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                        <table class="table table-custom mb-0">
                            <thead>
                                <tr>
                                    <th>Photo</th>
                                    <th>Name</th>
                                    <th>seat number</th>
                                    <th>class</th>
                                    <th>status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <a href="#">
                                            <img src="../images/products/3.jpg" class="rounded" width="60" alt="...">
                                        </a>
                                    </td>
                                    <td>John Doe</td>
                                    <td>1</td>
                                    <td>Econonmy</td>
                                    <td>Checked In
                                    <td>
                                </tr>
                                <tr>
                                    <td>
                                        <a href="#">
                                            <img src="../images/products/3.jpg" class="rounded" width="60" alt="...">
                                        </a>
                                    </td>
                                    <td>John Doe</td>
                                    <td>1</td>
                                    <td>Econonmy</td>
                                    <td>Checked In
                                    <td>
                                </tr>
                                <tr>
                                    <td>
                                        <a href="#">
                                            <img src="../images/products/3.jpg" class="rounded" width="60" alt="...">
                                        </a>
                                    </td>
                                    <td>John Doe</td>
                                    <td>1</td>
                                    <td>Econonmy</td>
                                    <td>Checked In
                                    <td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-12 mt-4 mt-lg-0">
            <div class="card mb-4">
                <div class="card-body">
                    <h6 class="card-title mb-4">Prices</h6>
                    <div class="row justify-content-center mb-3">
                        <div class="col-4 text-end">Economy :</div>
                        <div class="col-4">$520,96</div>
                    </div>
                    <div class="row justify-content-center mb-3">
                        <div class="col-4 text-end">vip :</div>
                        <div class="col-4">$1.520,96</div>
                    </div>
                    <div class="row justify-content-center mb-3">
                        <div class="col-4 text-end">First class :</div>
                        <div class="col-4">$1.273,77</div>
                    </div>

                </div>
            </div>

             @* <div class="card">
            <div class="card-body">
                        <div class="card-body">
                            <div id="sales-channels"></div>
                            <div class="row text-center mt-4">
                                <div class="col-4">
                                    <div class="display-7">4%</div>
                                    <div class="text-success my-2 small">
                                        <i class="bi bi-arrow-up me-1 small"></i>30.50%
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center">
                                        <i class="bi bi-circle-fill text-orange me-2 small"></i>
                                        <span class="text-muted">Travel agent</span>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="display-7">30%</div>
                                    <div class="text-danger my-2 small">
                                        <i class="bi bi-arrow-down me-1 small"></i>15.20%
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center">
                                        <i class="bi bi-circle-fill text-cyan me-2 small"></i>
                                        <span class="text-muted">Direct Website</span>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="display-7">22%</div>
                                    <div class="text-success my-2 small">
                                        <i class="bi bi-arrow-up me-1 small"></i>1.80%
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center">
                                        <i class="bi bi-circle-fill text-indigo me-2 small"></i>
                                        <span class="text-muted">Email</span>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
            </div>
            </div> *@
                <button class="btn btn-primary col-4 mt-3" id="editLink"  >Edit</button>
                <button class="btn btn-primary col-4 mt-3" id="saveLink" ">Save</button>
        </div>
           
    </div>
    
</div>

</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Dropdown options for editing fields (will be populated by backend data)
    let dropdownOptions = {
        Name: [], // Placeholder for crew names fetched dynamically
    };

    // Function to fetch data from the backend when "Edit" is clicked
    function enableEditing() {
        const editableFields = document.querySelectorAll(".editable");

        // Fetch crew names dynamically via GET request
        $.ajax({
            url: '/Admin/FlightDetails1?handler=Crew', // Razor Page handler URL for GET
            type: 'GET',
            dataType : 'json',
            success: function (response) {
                
                console.log(response);
                // Assuming crew names come as a JSON array from the backend
                dropdownOptions.Name = response.crewNames;

                editableFields.forEach(function (field) {
                    const text = field.textContent.trim(); // Get current content
                    const [label, value] = text.split(":").map((part) => part.trim()); // Split into label and value
                    let options = dropdownOptions[label]; // Get predefined options based on label

                    if (options) {
                        // Move the current value to the first position in the options array
                        options = [value, ...options.filter((option) => option !== value)];

                        // Build a dropdown <select> element
                        const selectElement = document.createElement("select");
                        options.forEach((option) => {
                            const optionElement = document.createElement("option");
                            optionElement.value = option;
                            optionElement.textContent = option;

                            // Preserve the current value as selected
                            if (option === value) {
                                optionElement.selected = true;
                            }

                            selectElement.appendChild(optionElement);
                        });

                        // Replace the field's content with the dropdown
                        field.innerHTML = `${label}: `;
                        field.appendChild(selectElement);
                    }
                });

                // Toggle visibility of Edit and Save links
                document.getElementById("editLink").style.display = "none";
                document.getElementById("saveLink").style.display = "inline-block";
            },
            error: function (error) {
                console.error("Error fetching crew data:", error);
                alert("An error occurred while fetching data.");
            },
        });
    }

    // Function to save changes (turns dropdowns back into static text and sends data to the backend)
    function saveChanges() {
        const editableFields = document.querySelectorAll(".editable");

        // Prepare data to send to the backend
        const requestData = {};
        editableFields.forEach(function (field) {
            const label = field.textContent.split(":")[0].trim(); // Extract label
            const selectElement = field.querySelector("select");
            if (selectElement) {
                const selectedValue = selectElement.value; // Get selected value
                field.textContent = `${label}: ${selectedValue}`; // Replace with static text

                // Add the selected value to the request data
                requestData[label.toLowerCase()] = selectedValue;
            }
        });

        // Get the CSRF token from the hidden input field
        const token = $('input[name="__RequestVerificationToken"]').val();

        // Send the data to the backend via POST request
        $.ajax({
            url: '/Admin/FlightDetails1?handler=Fun', // Razor Page handler URL for POST
            type: 'POST',
            headers: {
                'RequestVerificationToken': token, // Include CSRF token in the request header
            },
            contentType: 'application/json', // Send data as JSON
            data: JSON.stringify(requestData), // Send the data as JSON
            success: function (response) {
                alert("Changes saved successfully: " + response.result);
            },
            error: function (error) {
                console.error("Error saving data:", error);
                alert("An error occurred while saving.");
            },
        });

        // Toggle visibility of Save and Edit links
        document.getElementById("editLink").style.display = "inline-block";
        document.getElementById("saveLink").style.display = "none";
    }

    // Attach click events to Edit and Save links
    document.getElementById("editLink").addEventListener("click", function (event) {
        event.preventDefault();
        enableEditing();
    });

    document.getElementById("saveLink").addEventListener("click", function (event) {
        event.preventDefault();
        saveChanges();
    });
</script>


<!-- ./ layout-wrapper -->
<!-- JQuery -->
<script src="../libs/jquery-3.7.1.min.js"></script>

<!-- Nicescroll -->
<script src="../libs/nicescroll.js"></script>

<!-- Apex chart -->
<script src="../libs/charts/apex/apexcharts.min.js"></script>

<!-- Slick -->
<script src="../libs/slick/slick.min.js"></script>

<!-- Examples -->
<script src="../js/examples/dashboard.js"></script>

<!-- Main Javascript file -->
<script src="../js/app.js"></script>

<script src="~/my.js"> </script>
